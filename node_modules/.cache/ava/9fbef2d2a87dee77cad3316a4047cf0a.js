'use strict';

const test = require('ava');
const nock = require('nock');
const senagram = require('../');
const fixtures = require('./fixtures');

let options = {
  endpoints: {
    pictures: 'http://senagram.test/picture',
    users: 'http://senagram.test/user',
    auth: 'http://senagram.test/auth'
  }
};

test.beforeEach(t => {
  t.context.client = senagram.crearCliente(options);
});

test('cliente', t => {
  const client = senagram.crearCliente();

  t.is(typeof client.getPicture, 'function');
  t.is(typeof client.guardarPicture, 'function');
  t.is(typeof client.likePicture, 'function');
  t.is(typeof client.listaPicture, 'function');
  t.is(typeof client.listaPicturePorTag, 'function');
  t.is(typeof client.guardarUsuario, 'function');
  t.is(typeof client.getUsuario, 'function');
  t.is(typeof client.autenticar, 'function');
});

test('getPicture', async t => {
  const client = t.context.client;

  let imagen = fixtures.getImagen();

  nock(options.endpoints.pictures).get(`/${imagen.publicId}`).reply(200, imagen);

  let result = await client.getPicture(imagen.publicId);

  t.deepEqual(imagen, result);
});

test('guardarPicture', async t => {
  const client = t.context.client;

  let token = 'xxx-xxx-xxx';
  let imagen = fixtures.getImagen();
  let newImagen = {
    src: imagen.url,
    description: imagen.description
  };

  nock(options.endpoints.pictures, {
    reqheaders: {
      'Authorization': `Bearer ${token}`
    }
  }).post('/', newImagen).reply(201, imagen);

  let result = await client.guardarPicture(newImagen, token);

  t.deepEqual(imagen, result);
});

test('likePicture', async t => {
  const client = t.context.client;

  let imagen = fixtures.getImagen();

  imagen.liked = true;
  imagen.likes = 1;

  nock(options.endpoints.pictures).post(`/${imagen.publicId}/like`).reply(200, imagen);

  let result = await client.likePicture(imagen.publicId);

  t.deepEqual(imagen, result);
});
//# sourceMappingURL=..\node_modules\.cache\ava\9fbef2d2a87dee77cad3316a4047cf0a.js.map