{"version":3,"sources":["client-test.js"],"names":["test","require","nock","senagram","fixtures","options","endpoints","pictures","users","auth","beforeEach","t","context","client","crearCliente","is","getPicture","guardarPicture","likePicture","listaPicture","listaPicturePorTag","guardarUsuario","getUsuario","autenticar","imagen","getImagen","get","publicId","reply","result","deepEqual","token","newImagen","src","url","description","reqheaders","post","liked","likes","imagenes","getImagenes"],"mappings":"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","file":"client-test.js","sourcesContent":["'use strict'\r\n\r\nconst test = require('ava')\r\nconst nock = require('nock')\r\nconst senagram = require('../')\r\nconst fixtures = require('./fixtures')\r\n\r\nlet options = {\r\n  endpoints: {\r\n    pictures: 'http://senagram.test/picture',\r\n    users: 'http://senagram.test/user',\r\n    auth: 'http://senagram.test/auth'\r\n  }\r\n}\r\n\r\ntest.beforeEach(t => {\r\n  t.context.client = senagram.crearCliente(options)\r\n})\r\n\r\ntest('cliente', t => {\r\n  const client = senagram.crearCliente()\r\n\r\n  t.is(typeof client.getPicture, 'function')\r\n  t.is(typeof client.guardarPicture, 'function')\r\n  t.is(typeof client.likePicture, 'function')\r\n  t.is(typeof client.listaPicture, 'function')\r\n  t.is(typeof client.listaPicturePorTag, 'function')\r\n  t.is(typeof client.guardarUsuario, 'function')\r\n  t.is(typeof client.getUsuario, 'function')\r\n  t.is(typeof client.autenticar, 'function')\r\n})\r\n\r\ntest('getPicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let imagen = fixtures.getImagen()\r\n\r\n  nock(options.endpoints.pictures)\r\n  .get(`/${imagen.publicId}`)\r\n  .reply(200, imagen)\r\n\r\n  let result = await client.getPicture(imagen.publicId)\r\n\r\n  t.deepEqual(imagen, result)\r\n})\r\n\r\ntest('guardarPicture', async t => {\r\n  const client = t.context.client\r\n\r\n  // la ruta guardarPicture es segura por lo cual se crea un token\r\n  // token es como una palabra clave que reconoce el endpoitn\r\n  let token = 'xxx-xxx-xxx'\r\n  let imagen = fixtures.getImagen()\r\n  let newImagen = {\r\n    src: imagen.url,\r\n    description: imagen.description\r\n  }\r\n  // para enviar el header de autorizacion en el request se utiliza reqheaders que es una propiedad de nock\r\n  // endpoints es la primer capa de seguridad.\r\n  nock(options.endpoints.pictures, {\r\n    reqheaders: {\r\n      'Authorization': `Bearer ${token}`\r\n    }\r\n  })\r\n  // post es por que la ruta es asegura\r\n  .post('/', newImagen)\r\n  // el status code 201 es la de entidad creada\r\n  .reply(201, imagen)\r\n\r\n  let result = await client.guardarPicture(newImagen, token)\r\n\r\n  // garantizamos que la imagena es igual a resultado\r\n  t.deepEqual(imagen, result)\r\n})\r\n\r\ntest('likePicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let imagen = fixtures.getImagen()\r\n\r\n  imagen.liked = true\r\n  imagen.likes = 1\r\n\r\n  nock(options.endpoints.pictures)\r\n  .post(`/${imagen.publicId}/like`)\r\n  .reply(200, imagen)\r\n\r\n  let result = await client.likePicture(imagen.publicId)\r\n\r\n  t.deepEqual(imagen, result)\r\n})\r\n\r\ntest('listaPicture', async t => {\r\n  const client = t.context.client\r\n\r\n  let imagenes = fixtures.getImagenes(3)\r\n\r\n  nock(options.endpoints.pictures)\r\n  .get('/List')\r\n  .reply(200, imagenes)\r\n\r\n  let result = await client.listaPicture()\r\n\r\n  t.deepEqual(imagenes, result)\r\n})\r\n"]}